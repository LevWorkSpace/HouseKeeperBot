public with sharing class TelegramKeyMasterListener extends TelegramBotUpdateCommandListener {

    public static final String TEXT_MESSAGE = '–°—ñ–º-—Å—ñ–º...';

    private static final List<Map<String, String>> BUTTONS_LAYOUT = new List<Map<String, String>> {
            new Map<String, String> {
                    'p_1_cucle_1' => 'üöò1 - —à–ª–∞–≥–±–∞—É–º',
                    'hp_1_cucle_1' => 'üöò2 - —à–ª–∞–≥–±–∞—É–º'
            },
            new Map<String, String> {
                    'p_3_cucle_19' => 'üõíüö∂- —Ö–≤—ñ—Ä—Ç–∫–∞',
                    'p_3_cucle_17' => '‚¨Öüö∂ - —Ç—É—Ä–Ω—ñ–∫–µ—Ç',
                    'p_3_cucle_15' => '‚û°üö∂ - —Ç—É—Ä–Ω—ñ–∫–µ—Ç'
            },
            new Map<String, String> {
                    'SOCKET_RELAY_9.133:88_1' => 'üè°1 - –ø—ñ–¥‚Äò—ó–∑–¥',
                    'SOCKET_RELAY_9.133:88_2' => 'üè°2 - –ø—ñ–¥‚Äò—ó–∑–¥'
            }
    };

    public TelegramKeyMasterListener() {
        super(TELEGRAM_COMMAND.Iopen);
    }

    public override void dispatch(TelegramBotUpdateDTO tUpdate) {
        //shutdown
        TelegramBotApi.sendMessage(
            new TelegramBotService.MessageBuilder(tUpdate.message.chat.id)
                .setText('Service unavailable')
                .getMessage()
        );
        if (true) return;

        TelegramBotUpdateDTO.TG_Message message = tUpdate.message;
        try {
            Participant__c p = TelegramBotService.findParticipant(tUpdate.message.tFrom);
            if (p == null || p.FlatNumber__c == null) {
                TelegramBotService.sendNotRegisteredFlat(message.chat.id);
                return;
            }

            if (p.UserNumber__c == null) {
                HousingComplexService.sendNotLoggedIn(message.chat.id);
                return;
            }

            TelegramBotApi.sendMessage(
                    new TelegramBotService.MessageBuilder(message.chat.id)
                            .setText(TEXT_MESSAGE)
                            .setReplyMarkup(JSON.serialize(
                                    new TelegramBotApi.ReplyMarkup(BUTTONS_LAYOUT))
                            )
                            .getMessage()
            );
        } catch (Exception e) {
            Logger.error(e, tUpdate.message, 'TelegramKeyMasterListener.dispatch');
        }
    }
}